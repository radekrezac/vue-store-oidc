{"version":3,"file":"create-pinia-store.js","sourceRoot":"","sources":["create-pinia-store.ts"],"names":[],"mappings":"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","sourcesContent":["import createOidcStore from './create-vue-store'\r\nimport { objectAssign } from '../services/utils'\r\nimport { dispatchCustomBrowserEvent } from '../services/browser-event'\r\nimport { openUrlWithIframe } from '../services/navigation'\r\nimport type { StoreOidcListeners, StoreOidcSettings, StoreOidcClientSettings, OidcSigninSilentOptions, PayloadType } from '../types/vue-store'\r\nimport type { PiniaOidcStoreState, PiniaOidcStoreDefinition, PiniaOidcStore, PiniaOidcStoreGetters, PiniaOidcStoreAction } from '../types/pinia-store'\r\nimport type { RouteLocationNormalized } from 'vue-router'\r\nimport { defineStore } from 'pinia'\r\nimport type { User } from 'oidc-client-ts'\r\n\r\nexport default (oidcClientSettings: StoreOidcClientSettings, storeSettings: StoreOidcSettings = {}, oidcEventListeners: StoreOidcListeners = {}): PiniaOidcStoreDefinition => {\r\n\r\n  const { oidcUserManager, oidcClient, OidcStoreGetters,\r\n          routeIsPublic, routeIsOidcCallback, getPayloadItem, errorPayload, dispatchCustomErrorEvent, \r\n          addOidcEventListener, removeOidcEventListener, authenticateOidc,\r\n  } = createOidcStore(oidcClientSettings, storeSettings, oidcEventListeners)\r\n\r\n  const PiniaOidcStoreState: PiniaOidcStoreState = {\r\n    access_token: null,\r\n    id_token: null,\r\n    refresh_token: null,\r\n    user: null,\r\n    scopes: null,\r\n    is_checked: false,\r\n    events_are_bound: false,\r\n    error: null\r\n  }\r\n  const PiniaOidcStoreGetters: PiniaOidcStoreGetters = <PiniaOidcStoreGetters>OidcStoreGetters\r\n\r\n  const PiniaOidcStoreAction: PiniaOidcStoreAction = {\r\n    oidcCheckAccess(this: OidcStoreMembers, route: RouteLocationNormalized) {\r\n      return new Promise(resolve => {\r\n        if (routeIsOidcCallback(route)) {\r\n          resolve(true)\r\n          return\r\n        }\r\n        let hasAccess = true\r\n        const isAuthenticatedInStore = this.oidcIsAuthenticated\r\n        oidcUserManager.getUser().then(user => {\r\n          if (!user || user.expired) {\r\n            const authenticateSilently = oidcClientSettings.silentRedirectUri && oidcClientSettings.automaticSilentSignin\r\n            if (routeIsPublic(route)) {\r\n              if (isAuthenticatedInStore) {\r\n                this.unsetOidcAuth()\r\n              }\r\n              if (authenticateSilently) {\r\n                this.authenticateOidc()\r\n                this.authenticateOidcSilent({ ignoreErrors: true } as OidcSigninSilentOptions)\r\n                  .catch(() => { })\r\n              }\r\n            } \r\n            else {\r\n              const authenticate = () => {\r\n                if (isAuthenticatedInStore) {\r\n                  this.unsetOidcAuth()\r\n                }\r\n                this.authenticateOidc(route.fullPath)\r\n              }\r\n              // If silent signin is set up, try to authenticate silently before denying access\r\n              if (authenticateSilently) {\r\n                this.authenticateOidcSilent({ ignoreErrors: true } as OidcSigninSilentOptions)\r\n                  .then(() => {\r\n                    oidcUserManager.getUser().then(user => {\r\n                      if (!user || user.expired) {\r\n                        authenticate()\r\n                      }\r\n                      resolve(!!user)\r\n                    }).catch(() => {\r\n                      authenticate()\r\n                      resolve(false)\r\n                    })\r\n                  })\r\n                  .catch(() => {\r\n                    authenticate()\r\n                    resolve(false)\r\n                  })\r\n                return\r\n              }\r\n              // If no silent signin is set up, perform explicit authentication and deny access\r\n              authenticate()\r\n              hasAccess = false\r\n            }\r\n          }\r\n          else {\r\n            this.oidcWasAuthenticated(user)\r\n            if (!isAuthenticatedInStore) {\r\n              if (oidcEventListeners && typeof oidcEventListeners.userLoaded === 'function') {\r\n                oidcEventListeners.userLoaded(user)\r\n              }\r\n              if (storeSettings.dispatchEventsOnWindow) {\r\n                dispatchCustomBrowserEvent('userLoaded', user)\r\n              }\r\n            }\r\n          }\r\n          resolve(hasAccess)\r\n        })\r\n      })\r\n    },\r\n    authenticateOidcSilent(this: OidcStoreMembers, payload?: PayloadType) {\r\n      // Take options for signinSilent from 1) payload or 2) storeSettings if defined there\r\n      const options = getPayloadItem(payload, 'option') || storeSettings.defaultSigninSilentOptions || {}\r\n      return new Promise<User | null>((resolve, reject) => {\r\n        oidcUserManager.signinSilent(options)\r\n          .then(user => {\r\n            this.oidcWasAuthenticated(user)\r\n            resolve(user)\r\n          })\r\n          .catch(err => {\r\n            this.setOidcAuthIsChecked()\r\n            if (getPayloadItem(payload, 'ignoreErrors')) {\r\n              resolve(null)\r\n            } else {\r\n              this.setOidcError(errorPayload('authenticateOidcSilent', err))\r\n              reject(err)\r\n            }\r\n          })\r\n      })\r\n    },\r\n    authenticateOidc(this: OidcStoreMembers, payload?) {\r\n      return authenticateOidc(payload)\r\n        .catch(err => this.setOidcError(errorPayload('authenticateOidc', err)))\r\n    },\r\n    oidcSignInCallback(this: OidcStoreMembers, url) {\r\n      return new Promise((resolve, reject) => {\r\n        oidcUserManager.signinRedirectCallback(url)\r\n          .then(user => {\r\n            this.oidcWasAuthenticated(user)\r\n            resolve(sessionStorage.getItem('vue_oidc_active_route') || '/')\r\n          })\r\n          .catch(err => {\r\n            this.setOidcError(errorPayload('oidcSignInCallback', err))\r\n            this.setOidcAuthIsChecked\r\n            reject(err)\r\n          })\r\n      })\r\n    },\r\n    authenticateOidcPopup(this: OidcStoreMembers, payload = {}) {\r\n      // Take options for signinPopup from 1) payload or 2) storeSettings if defined there\r\n      const options = getPayloadItem(payload, 'options') || storeSettings.defaultSigninPopupOptions || {}\r\n      return oidcUserManager.signinPopup(options)\r\n        .then(user => {\r\n          this.oidcWasAuthenticated(user)\r\n        })\r\n        .catch(err => {\r\n          this.setOidcError(errorPayload('authenticateOidcPopup', err))\r\n        })\r\n    },\r\n    oidcSignInPopupCallback(this: OidcStoreMembers, url) {\r\n      return new Promise((resolve, reject) => {\r\n        oidcUserManager.signinPopupCallback(url)\r\n          .catch(err => {\r\n            this.setOidcError(errorPayload('oidcSignInPopupCallback', err))\r\n            this.setOidcAuthIsChecked()\r\n            reject(err)\r\n          })\r\n      })\r\n    },\r\n    oidcWasAuthenticated(this: OidcStoreMembers, user) {\r\n      if (user) {\r\n        this.setOidcAuth(user)\r\n      }\r\n      if (!this.events_are_bound) {\r\n        oidcUserManager.events.addAccessTokenExpired(() => { this.unsetOidcAuth() })\r\n        if (oidcClientSettings.automaticSilentRenew) {\r\n          oidcUserManager.events.addAccessTokenExpiring(() => {\r\n            this.authenticateOidcSilent()\r\n              .catch((err) => {\r\n                dispatchCustomErrorEvent('automaticSilentRenewError', errorPayload('authenticateOidcSilent', err))\r\n              })\r\n          })\r\n        }\r\n        this.setOidcEventsAreBound()\r\n      }\r\n      this.setOidcAuthIsChecked()\r\n    },\r\n    storeUser(this: OidcStoreMembers, user) {\r\n      return oidcUserManager.storeUser(user)\r\n        .then(() => oidcUserManager.getUser())\r\n        .then(user => this.oidcWasAuthenticated(user))\r\n        .then(() => { })\r\n        .catch(err => {\r\n          this.setOidcError(errorPayload('OidcStoreUser', err))\r\n          this.setOidcAuthIsChecked()\r\n          throw err\r\n        })\r\n    },\r\n    getUser() {\r\n      return oidcUserManager.getUser().then(user => {\r\n        if (user) {\r\n          this.setUser(user)\r\n        }\r\n        return user\r\n      })\r\n    },\r\n    addOidcEventListener(this: OidcStoreMembers, payload) {\r\n      addOidcEventListener(payload)\r\n    },\r\n    removeOidcEventListener(this: OidcStoreMembers, payload) {\r\n      removeOidcEventListener(payload)\r\n    },\r\n    signOutOidc(this: OidcStoreMembers, payload) {\r\n      return oidcUserManager.signoutRedirect(payload).then(() => {\r\n        this.unsetOidcAuth()\r\n      })\r\n    },\r\n    signOutOidcCallback() {\r\n      return oidcUserManager.signoutRedirectCallback()\r\n    },\r\n    signOutPopupOidc(this: OidcStoreMembers, payload) {\r\n      return oidcUserManager.signoutPopup(payload).then(() => {\r\n        this.unsetOidcAuth()\r\n      })\r\n    },\r\n    signOutPopupOidcCallback() {\r\n      return oidcUserManager.signoutPopupCallback()\r\n    },\r\n    signOutOidcSilent(this: OidcStoreMembers, payload) {\r\n      return new Promise((resolve, reject) => {\r\n        try {\r\n          oidcUserManager.getUser()\r\n            .then((user) => {\r\n              const args = objectAssign([\r\n                payload || {},\r\n                {\r\n                  id_token_hint: user ? user.id_token : null\r\n                }\r\n              ])\r\n              if (payload && getPayloadItem(payload, 'id_token_hint')) {\r\n                args.id_token_hint = getPayloadItem(payload, 'id_token_hint')\r\n              }\r\n              if (oidcClient) {\r\n                oidcClient.createSignoutRequest(args)\r\n                  .then((signoutRequest) => {\r\n                    openUrlWithIframe(signoutRequest.url)\r\n                      .then(() => {\r\n                        this.removeUser()\r\n                        resolve()\r\n                      })\r\n                      .catch((err) => reject(err))\r\n                  })\r\n                  .catch((err: any) => reject(err))\r\n              }\r\n            })\r\n            .catch((err) => reject(err))\r\n        } catch (err) {\r\n          reject(err)\r\n        }\r\n      })\r\n    },\r\n    removeUser(this: OidcStoreMembers) {\r\n      return this.removeUser()\r\n    },\r\n    removeUser(this: OidcStoreMembers) {\r\n      return oidcUserManager.removeUser().then(() => {\r\n        this.unsetOidcAuth()\r\n      })\r\n    },\r\n    clearStaleState() {\r\n      return oidcUserManager.clearStaleState()\r\n    },\r\n    //mutation\r\n    setOidcAuth(this: OidcStoreMembers, user: User) {\r\n      this.id_token = user.id_token\r\n      this.access_token = user.access_token\r\n      this.refresh_token = user.refresh_token\r\n      this.user = user.profile\r\n      this.scopes = user.scopes\r\n      this.error = null\r\n    },\r\n    setUser(this: OidcStoreMembers, user: User) {\r\n      this.user = user ? user.profile : null\r\n    },\r\n    unsetOidcAuth(this: OidcStoreMembers) {\r\n      this.id_token = null\r\n      this.access_token = null\r\n      this.refresh_token = null\r\n      this.user = null\r\n    },\r\n    setOidcAuthIsChecked(this: OidcStoreMembers) {\r\n      this.is_checked = true\r\n    },\r\n    setOidcEventsAreBound(this: OidcStoreMembers) {\r\n      this.events_are_bound = true\r\n    },\r\n    setOidcError(this: OidcStoreMembers, payload) {\r\n      if (payload) {\r\n        this.error = getPayloadItem(payload, 'error')\r\n        dispatchCustomErrorEvent('oidcError', payload)\r\n      }\r\n    }\r\n  }\r\n  return defineStore({ id: 'auth', state: () => PiniaOidcStoreState, getters: PiniaOidcStoreGetters, actions: PiniaOidcStoreAction })\r\n}\r\n\r\n\r\n"]}